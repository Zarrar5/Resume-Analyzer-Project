<!DOCTYPE html>
<html lang= "en">
    <head>
        <meta charset= "UTF-8">
        <title>User Login</title>
    </head>
    <body>
        <h2>LOGIN</h2>
        <div>
            <form onsubmit= "login(event)">
                <label>Username:</label>
                <input id="username" type="text" name="username" required>
                <br>
                
                <label>Password:</label>
                <input id="password" type="password" name="password" required>
                <br>

                <input type="submit" value="Login"/>
            </form>
        </div>
        <div>
            <p>Don't have an account <a href="/api/register">Sign up here</a></p>
        </div>

        <script>
            async function login(event) {
                event.preventDefault();

                const username = document.getElementById("username").value;
                const password = document.getElementById("password").value;
                
                //create a new form
                const formData = new FormData();
                formData.append("username", username);
                formData.append("password", password);

                const response = await fetch("/api/login", {
                    method: "POST",
                    body: formData,
                });

                if (response.ok) {
                    const data = await response.json();
                    const token = data.token;
                    // Store the token in localStorage or cookie
                    localStorage.setItem("access_token", token);
                    alert("Login successful!");
                    // Optionally, redirect to a different page after login
                    // window.location.href = '/dashboard';
                } else {
                    alert("Invalid login credentials");
                }
            }
        </script>
    </body>
</html>